<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Importar Dados para Google Sheets</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f9;
      padding: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    table, th, td {
      border: 1px solid #ddd;
    }
    th, td {
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #4CAF50;
      color: white;
    }
    button {
      padding: 10px 20px;
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
      font-size: 16px;
    }
    button:hover {
      background-color: #45a049;
    }
  </style>
</head>
<body>

  <h1>Importar Dados da Planilha</h1>
  <input type="file" id="file-input" accept=".xlsx"/>
  <button onclick="submitData()">Enviar Dados</button>

  <table id="data-table">
    <thead>
      <tr>
        <th>Cliente</th>
        <th>Entrada</th>
        <th>Código de Barras</th>
        <th>Descrição</th>
        <th>M.S</th>
        <th>Umidade</th>
        <th>FDA</th>
        <th>FDNmo</th>
        <th>Lignina</th>
        <th>Amido</th>
        <th>P. Bruta</th>
        <th>PIDA</th>
        <th>PIDN</th>
        <th>P. Soluvel</th>
        <th>E.E</th>
        <th>Cinzas</th>
        <th>pH</th>
        <th>A. Lático</th>
        <th>A. Acético</th>
        <th>A. Butírico</th>
        <th>dFDNp 48h</th>
        <th>uFDN 240h</th>
        <th>Dig. In situ do Amido 7h</th>
        <th>Kd do FDN</th>
        <th>Kd do Amido</th>
        <th>NDT</th>
        <th>Milk/Ton</th>
      </tr>
    </thead>
    <tbody>
    </tbody>
  </table>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
  <script>
    let sheetData = [];

    document.getElementById('file-input').addEventListener('change', (e) => {
      let file = e.target.files[0];
      if (file) {
        let reader = new FileReader();
        
        reader.onload = function(event) {
          let data = new Uint8Array(event.target.result);
          let workbook = XLSX.read(data, { type: 'array' });
          
          // Assumindo que os dados estão na primeira planilha
          let worksheet = workbook.Sheets[workbook.SheetNames[0]];
          let jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

          // Log para verificar os dados extraídos
          console.log('Dados extraídos:', jsonData);
          
          // Coletando dados das células específicas
          sheetData = [];
          for (let i = 5; i < jsonData.length; i++) {
            let row = jsonData[i];
            sheetData.push({
              Cliente: row[0],
              Entrada: row[5],
              CodigoDeBarras: row[7],
              Descricao: row[8],
              MS: row[91],
              Umidade: row[92],
              FDA: row[93],
              FDNmo: row[95],
              Lignina: row[96],
              Amido: row[97],
              PBruta: row[104],
              PIDA: row[107],
              PIDN: row[108],
              PSoluvel: row[112],
              EE: row[120],
              Cinzas: row[136],
              pH: row[142],
              ALactico: row[143],
              AAcetico: row[144],
              AButirico: row[145],
              dFDNp48h: row[157],
              uFDN240h: row[167],
              DigInSituAmido7h: row[177],
              KdFDN: row[180],
              KdAmido: row[181],
              NDT: row[186],
              MilkTon: row[187]
            });
          }

          // Exibindo os dados na tabela
          displayTable(sheetData);
        };

        reader.readAsArrayBuffer(file);
      }
    });

    function displayTable(data) {
      const tbody = document.getElementById('data-table').getElementsByTagName('tbody')[0];
      tbody.innerHTML = ""; // Limpar a tabela antes de exibir os dados

      // Verifica se há dados para exibir
      if (data.length === 0) {
        alert("Nenhum dado encontrado no arquivo.");
        return;
      }

      data.forEach((rowData) => {
        let row = document.createElement('tr');
        for (let key in rowData) {
          let cell = document.createElement('td');
          cell.textContent = rowData[key];
          row.appendChild(cell);
        }
        tbody.appendChild(row);
      });
    }

    function submitData() {
      if (sheetData.length === 0) {
        alert("Nenhum dado para enviar.");
        return;
      }

      // Enviar os dados para o Google Sheets usando o App Script
      const url = 'https://script.google.com/macros/s/AKfycbxIBjwHVPOudpdYFxHjQfG3kGaV_tMvYwfsp1ACv9kWuwwfQBtVdTV1yxoMT_miW3OD/exec'; // Substitua pelo seu App Script URL
      fetch(url, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(sheetData)
      })
      .then(response => response.json())
      .then(data => alert('Dados enviados com sucesso!'))
      .catch(error => {
        console.error('Erro ao enviar os dados:', error);
        alert('Ocorreu um erro ao enviar os dados.');
      });
    }
  </script>

</body>
</html>
