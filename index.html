<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Importar Dados para Google Sheets</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f9;
      padding: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    table, th, td {
      border: 1px solid #ddd;
    }
    th, td {
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #4CAF50;
      color: white;
    }
    button {
      padding: 10px 20px;
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
      font-size: 16px;
    }
    button:hover {
      background-color: #45a049;
    }
  </style>
</head>
<body>

  <h1>Importar Dados da Planilha</h1>
  <input type="file" id="file-input" accept=".xlsx"/>
  <button onclick="submitData()">Enviar Dados</button>

  <table id="data-table">
    <thead>
      <tr>
        <th>Cliente</th>
        <th>Entrada</th>
        <th>Código de Barras</th>
        <th>Descrição</th>
        <th>M.S</th>
        <th>Umidade</th>
        <th>FDA</th>
        <th>FDNmo</th>
        <th>Lignina</th>
        <th>Amido</th>
        <th>P. Bruta</th>
        <th>PIDA</th>
        <th>PIDN</th>
        <th>P. Soluvel</th>
        <th>E.E</th>
        <th>Cinzas</th>
        <th>pH</th>
        <th>A. Lático</th>
        <th>A. Acético</th>
        <th>A. Butírico</th>
        <th>dFDNp 48h</th>
        <th>uFDN 240h</th>
        <th>Dig. In situ do Amido 7h</th>
        <th>Kd do FDN</th>
        <th>Kd do Amido</th>
        <th>NDT</th>
        <th>Milk/Ton</th>
      </tr>
    </thead>
    <tbody>
    </tbody>
  </table>

  <script>
    let sheetData = [];

    document.getElementById('file-input').addEventListener('change', (e) => {
      let file = e.target.files[0];
      let reader = new FileReader();

      reader.onload = function(event) {
        let data = new Uint8Array(event.target.result);
        let workbook = XLSX.read(data, { type: 'array' });
        
        // Assumindo que os dados estão na primeira planilha
        let worksheet = workbook.Sheets[workbook.SheetNames[0]];
        let jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

        // Coletando dados das células específicas (de A6 até GF6)
        sheetData = [];
        for (let i = 5; i < jsonData.length; i++) {
          let row = jsonData[i];
          sheetData.push({
            Cliente: row[0],
            Entrada: row[5],
            CodigoDeBarras: row[7],
            Descricao: row[8],
            MS: row[93],
            Umidade: row[94],
            FDA: row[95],
            FDNmo: row[96],
            Lignina: row[97],
            Amido: row[98],
            PBruta: row[99],
            PIDA: row[100],
            PIDN: row[101],
            PSoluvel: row[102],
            EE: row[104],
            Cinzas: row[105],
            pH: row[106],
            ALactico: row[107],
            AAcetico: row[108],
            AButirico: row[109],
            dFDNp48h: row[110],
            uFDN240h: row[111],
            DigInSituAmido7h: row[112],
            KdFDN: row[113],
            KdAmido: row[114],
            NDT: row[115],
            MilkTon: row[116]
          });
        }

        // Exibindo os dados na tabela
        displayTable(sheetData);
      };

      reader.readAsArrayBuffer(file);
    });

    function displayTable(data) {
      const tbody = document.getElementById('data-table').getElementsByTagName('tbody')[0];
      tbody.innerHTML = ""; // Limpar a tabela antes de exibir os dados

      data.forEach((rowData) => {
        let row = document.createElement('tr');
        for (let key in rowData) {
          let cell = document.createElement('td');
          cell.textContent = rowData[key];
          row.appendChild(cell);
        }
        tbody.appendChild(row);
      });
    }

    function submitData() {
      // Enviar os dados para o Google Sheets usando o App Script
      const url = 'https://script.google.com/macros/s/SEU_SCRIPT_URL/exec'; // Substitua pelo seu App Script URL
      fetch(url, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(sheetData)
      })
      .then(response => response.json())
      .then(data => alert('Dados enviados com sucesso!'))
      .catch(error => {
        console.error('Erro ao enviar os dados:', error);
        alert('Ocorreu um erro ao enviar os dados.');
      });
    }
  </script>

</body>
</html>
